<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Running phenotype detection</title>
		<meta name='Generator' content='Zim 0.65'>
		<style type='text/css'>
	<style type='text/css'>
			body     { background-color: #fff;
			           color: #000;
			           font-size: large              }
			a        { text-decoration: none         }
			a:hover  { text-decoration: underline    }
			a:active { text-decoration: underline    }
			strike   { color: grey                   }
			u        { text-decoration: none;
			           background-color: yellow      }
			tt         { color: #2e3436;             }
			pre      { background-color: lightyellow }
			h1         { text-decoration: underline;
						 color: #4e9a06; margin-bottom: 0 }
			h2         { color: #4e9a06; margin-bottom: 0 }
			h3         { color: #4e9a06; margin-bottom: 0 }
			h4         { color: #4e9a06; margin-bottom: 0 }
			h5         { color: #4e9a06; margin-bottom: 0 }
			p          { margin-top: 0              }
			span.zim-tag {
				color: #ce5c00;
			}
			div.zim-object {
				border-style:solid;
				border-width:1px;
			}
			.checked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8sMEGsKGkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEBUlEQVRIx62V22tdRRTGf7Nn73P2ybntnNOe3NqkPTGgLTVUUZF6QatSLOKTPgqCIqLgQ0H/A1sQQbBYCBb1QfAxiC8tSO1FqHkwJVKtjdTGNraUmObsc9nXmfGh7cGYpM1D5nHWzPetteZb3wg2eB2YqYm4zSadsMtoboiNBH/3TE0awx6j+MRoxoTg/IYRvP19TQrJS0bzhdHGSyKFkLTtjSKwMjyiEz43ynhtP6bdjBCWyFobAf7eT7VhNF/q1FRbjYjmUohlCVPwnB+6FUxMTJipqSmUUhhjEGKd3bMT4ks/Y6oLBK2Yth8hHYtCJXOix7Nf7xLMzc0xOzvLzp078TyPNE3viW3QJPXzhNWbxFFKHCmMhoLn/FHodd48vGfhapdAacXQlkFK5dL6wIUm6fuTZPuvqDQhaMUYYyiVyuQr6rXDexYuAdi3tSv1ZJNs/R/CaszzT+1na88uXFnCEnJVgivBNN8uTJKmHQI/ptOOcXNZzMz9mOqFs90OHpipWcYwlo5P4ebnuOkrvr5wgrH+h3im7y36MzuwRXYZeKha/OhP0EkadFoxQSdGSotedR/+XwMc2XvKdNUFOFqZx6LKZWIiwjgkikNmLp/hm8sH+K1zjFTHXfBYdTi+eJArzXM0GxFxoBDCopLvo/fqEwi1XPkWkGqjFo2TgB1jOYZUKZTS/D1/ncmLh7jon0IbRWoiTi59ymzzJEEQE3cStNZsGxqlfPE57MBbOR8fP3hDGalOO9fq2DlBvmZw8xa2IxACGn6TydlD/O6f5OzSV/zif0cYhLQaEXGkKBbz7Ov/AOlXV1cxgBJRI3fuSTrpTawt18kWIZN1CFuaONI0w0WOXfsI43YIggh/KUSlhqxrMz74AkOZcWBm9QkH+Gw8NDLuITi+m0yzhluSyJzBLcpblUhFxywSRAEtPwQjsKVN30CNh0uvYuOubSHLtN3J0TO1j0pmBNuFbFWRK0gyPRZpktL2I5JQkclKakNlnh54g6ocvevUr/Ai2a7wineEkcJupA3S1Wg0nVZM2E6wbEF5U5G9Q++wI7sfR7h3N8HVNstykBfzH+KJEZwiWD0aIwxCgJ0R1Mu7GXOeJSuK93bZtQIle4D9pUNU5DC5jEsu55AvZakM5NicGyEj8uuz8bUCQgj67QfY671P3vEoeC69gy695U1U7NG7XV0pUwBjDJa1/JJlWWxzHuflzQe5FJ/GsgUVuZ2t8lEkTvfc0aNHb72flBhjVicQQqCUuvM3/M+WDVguWBrMVdDXEGZlBVEUrVCU9d9s5+fnaTQa2PZyPxEIhJaI1EEoZwX4ncynp6fXrmB4eJjR0VFarRbNZnP9P9rt9gohqNVq1Ov1ZbF/AZGev3hLJ2/zAAAAAElFTkSuQmCC)}
			.xchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8bDYnDxEwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEK0lEQVRIx9WVS2hTWRjHf/eR3CY1nbxMH2YiZRQS6qO13YlMVxY3SnVcuNIBFezGpSADLoQqLu1sHJCqdCFSXFpw4YOCSH3BtFqttTNamabX3DS5bfO6uffMoglja3RGcDMHzuac7/z/53++//cd+L8P6VuCPQYZ8ADNgBd4J31DcDcQs+GnHByRocEDv0kfBSjAOlYCs11Q+gpwDegS8LMJ+3QIK0ATzEhV8Odnz5bzw8P4dJ25aJQ/WlvJ1df/K7hSLtOcTNI+Pk69rpMTgqIQhCDvh1/VSpw79+gRrRMTmLZNezLJJsPg+a5dmOEwQlFqg1sWG16/Jv7sGWXDwBACFQjC9HcwIMONKkGp4PGAJGEDS0IQmZlhnWnye3c3eiyGo6qr3WHbrJ+dJf7gAXI6zSIr72T7/fgzmT4FHnTBsgrQBfYvTU0km5vxz86iADnAm0rRPTWFt7cXZccOJJcLAGHb2K9ekT93jmwmwwdAAFpjI6Ntbfxw5879ag7l6o1sr5eHHR3IsRgeQK/M4sQE+YEB7JcvEY6zAj45SWFgAPPxYwzHoQxIkQjTPT0kIxE+Noj8sexFn4/xnh58iQTeSpHkHAdrbIzi0BCOrmNPTpK/eJHM3bt8sCyKQCiR4NWePWSiUZw1+ZLXJm4pFKLhzBlCsRh2RUXacVgeGaF47RrL58+zcP8+RrmMkCQinZ1EL1zAjERqmkH+tLYl1G3bCJw4QUjT0IA0MJfLMX/5MqmHD0nZNiUgtGULG/r7ccXjINWuWbnmqsuFu7sb/4EDNLlcBIEioNs2KUAFGmMxmk6dQm1tRZI+3xBqEkiShBQOox05Ql1nJ26gvuIUAWiKQnj/ftStW5Fk+YuF+NldsbBA4cYN9KdPmaso8Fc62ZJtk7l1C2t0FGdxESHE1xE4hkHh6lX0oSHSpRIewC/LrPf7CSgKNpCamkI/fZr8pUuIZBIcpyaBunahPp1mub+fDyMjGKUSChCsq6Nh717q9u2jbnSU0uAgRrFIwTThyhUCqRS+hgZKLS1fJvDm87SNjZGcnsYUAjcQ8vsJ9/Xh7u1FDgRQN20iks3iDA+zZFmYhQLqzZtsj8WY3L0baY2Sf55ICCKpFHUzM2SEQAJCHg+hY8fQDh5EDgRWDoRC1J88SePRo2geD0XAcBy8b98Sv3ePYDZbbf2rFQjLIphMsmDbaEBQVQkePox26BCSz7e6i4bDrDt+nGYhmBscpFAskheC4Js3bPR4qHphFYEnlcI7P4/jdqNpGu8TCe4oCsXr1z//F2ga3+/cSfTJE0qmSVYIsKzaOZDcbjKyzFIiwfvt21kMBLA07YsetzWNd+3tLLW0sH5igvT8PH9Go/z44kX+E4LGjg7GDYOcy4XlOEgLC//5P/5LCFzxOPLmzWyIx+m6fduu7v0NVGqyTSycKksAAAAASUVORK5CYII=)}
			.unchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8qAt8h3m8AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAA60lEQVRIx+2VsQqDMBRF70sCLg5OLoKgjk7+lJ/hh+STXBwcnRz8ArMEkrxOFktbaC3tULzTg5e8k5vADXDq70VbobXmvu/hvQczg4heHrJfXxQFuq67blZbMc8zpmlCXddIkgTOuZcBUko45zCOI6y1Nz2xFSEEZFmGOI7fGg4A3nsQEZqmuXOu9jallACAtm3fvmutNaIoAjM/dkBECCF89KCbk4eAb+kEnIAT8EsAM0OIz3hSyrssUvss8t5fg+uIrLXPs0gIgWVZYIyBUurQyYdheO4gz3NUVQVjDNZ1PfSjpWmKsixvehfB9GBZ3NndrgAAAABJRU5ErkJggg==)}
			ul {list-style-image: none}
			/* ul rule needed to reset style for sub-bullets */

			.bar     { background-color: #E0E0FF;
			           margin: 0                     }
			.nav     { color: grey;
			           font-size: small              }
		</style>
		<script type='text/javascript'>
		<!--
// Slideshow script - adapted from old kwiki package

function nextSlide() {
	window.location="./Statistics.html"
}

function prevSlide() {
	window.location="./Quick_start.html"
}


function handleKey(e) {
	var key;
	if (e == null) { // IE
		key = event.keyCode
	}
	else { // Mozilla
		if (e.altKey || e.ctrlKey) {
			return true
		}
		key = e.which
	}

	switch(key) {
		case 8: prevSlide(); break // Backspace
		case 13: nextSlide(); break // Enter
		case 32: nextSlide(); break // Space
		default:
	}

	return false
}

document.onkeypress = handleKey
// document.onclick = nextSlide
// document.ondblclick = prevSlide

// End slideshow script
		// -->
		</script>
	</head>

	<body>

	<table width="100%" height="100%" border="0" cellpadding="5" cellspacing="0">
		<tr>
			<td colspan="3" align="center" valign="middle" class="bar">
				<h3 class='bar'>Running phenotype detection</h3>
			</td>
		</tr>
		<tr>
			<td width="5%">&nbsp;</td>
			<td width="90%" height="90%" align="center" valign="top">

				<table><tr><td align='left'>
<!-- Wiki content -->

<p>
Created Friday 22 January 2016
</p>

<h2>Overview</h2>

<br>

<p>
Phenotype detection occurs in two stage:
</p>

<p>
<ol type="1" start="1">
<li>Run the wild type test set. This stage creates registrered images, deformation fields, inversion files, inverted label maps etc.</li>
<li>Run the mutant test set.  As (1) with an additional statistical analysis stage using the files generated in (1) and (2). </li>
</ol>
</p>

<p>
During each of these stages, the taget image will be the population average created as described <a href="./Creating_a_population_average.html" title="here" class="page">here</a>
</p>

<br>

<h2>Running the wildtype test set</h2>

<p>
<b>command line </b><br>
<div style='padding-left: 30pt'>
<tt>lama.py -c path/to/config.yaml</tt>
</div>
<b>windows executable</b><br>
<div style='padding-left: 30pt'>
click on <tt>windows/lama</tt><br>
You will then be prompted for the path to the config file. This can be achieved by dragging the file into the command window
</div>
</p>

<br>

<h2>Requirements</h2>

<p>
<ul>
<li>A target volume, probably a population average, the creation of which is described <a href="./Creating_a_population_average.html" title="here." class="page">here.</a></li>
<li>Wild type test volumes (Should be different from the inputs to the population average)</li>
<li>config file </li>
</ul>
</p>

<p>
A typical folder structure for running the wild type test set would look like this
</p>

<p>
<img src="./Running_phenotype_detection/pasted_image007.png">
</p>

<h2>Config file</h2>

<br>

<p>
<b>Target</b><br>
Set the target to remain the same at each stage with the following line in the config file.
</p>

<p>
<div style='padding-left: 30pt'>
<tt>generate_new_target_each_stage: false</tt>
</div>
</p>

<p>
<b>Groups file</b><br>
A csv file that specifies which specimens belong to which groups for the purpose of the linear model analysis.<br>
If no groups.csv file is given, the specimens are are just split into wild type and mutants and the the following formula is used data ~ genotype <b>(not done this yet)</b>
</p>

<p>
<img src="./Running_phenotype_detection/pasted_image.png">
</p>

<p>
<b>Organ names</b><br>
If a labelmap is supplied, a organ/label name text file can also be given, with one organ name on each line. <br>
The first name specified with be for label 1 and the second for two etc. 
</p>

<p>
config: 
</p>

<p>
organ_names: organ_names.txt<br>
default = False
</p>

<p>
<img src="./Running_phenotype_detection/pasted_image004.png">
</p>

<p>
<b>Formulas</b><br>
One or more formulas to use in the linear model analysis<br>
Default:  data ~ genotype<br>
formulas [data ~ genotype, data ~ genotype + sex]
</p>

<p>
<b>Normalization</b><br>
After registration, a simple normalization step can be perfomed which applies a simple linear transformation to the image intesites in order to remove background noise.
</p>

<p>
The roi is specified in the config file as tow lists. [z start, y start, x start], [ z end, y end, x end]<br>
background_roi_zyx_norm: <a href="" title="35, 200, 130], [45, 210, 140 " class="page">35, 200, 130], [45, 210, 140 </a>    
</p>

<p>
Below is an example showing the placement of the roi in a region of background on the target image
</p>

<p>
<img src="./Running_phenotype_detection/pasted_image001.png">
</p>

<p>
<b>Output of the wt test set run</b>
</p>

<p>
This is the structure of the output folder of a typical run
</p>

<p>
<img src="./Running_phenotype_detection/pasted_image003.png">
</p>

<p>
<ul>
<li><b>averages</b></li>
</ul>
<div style='padding-left: 30pt'>
The mean intensity image of the registered images at each stage
</div>
<ul>
<li><b>deformations</b></li>
</ul>
<div style='padding-left: 30pt'>
The deformation vectors generated from the x stage to the final stage
</div>
<ul>
<li><b>inverted_labels</b></li>
</ul>
<div style='padding-left: 30pt'>
The label map inverted back to the rigidly-aligned images
</div>
<ul>
<li><b>inverted transforms</b></li>
</ul>
<div style='padding-left: 30pt'>
<tt>elastix</tt> parameter files inverted for use in inverting other files at a later date
</div>
<ul>
<li><b>normalised_intensity_images</b></li>
</ul>
<div style='padding-left: 30pt'>
The background-normalised registered images
</div>
<ul>
<li><b>padded_inputs</b></li>
</ul>
<div style='padding-left: 30pt'>
The input images padded to either the specified value or the largest input dimensions
</div>
<ul>
<li><b>padded target</b></li>
</ul>
<div style='padding-left: 30pt'>
Padded target, labelmap, and mask if given
</div>
<ul>
<li><b>qc_images</b></li>
</ul>
<div style='padding-left: 30pt'>
For each registration stage, a mid-sgittal slice is saved as an image. Can be useful to quickly check if registration has proceded without problems
</div>
<ul>
<li><b>registrations</b></li>
</ul>
<div style='padding-left: 30pt'>
registrations with output images, logs, and parameter files for each stage
</div>
<ul>
<li><b>organ_volumes.csv</b></li>
</ul>
<div style='padding-left: 30pt'>
if a label map and orgasn names was given, a csv file with the calculated giving the original organ volumes in voxels 
</div>
</p>

<p>
After running lama.py, a new config file is created in the same folder as the orginal config file, prepended with pheno_detect.yaml. <br>
This file contains some paths and values that were updated during the orignal registration, such as the padded volumes paths and the new padding dimensions.
</p>

<p>
All the paths in this file are relative so the wildtype project directory can be moved, but all folders and files within the project directory must remain in the same place for doenstream analysis to work correctly.
</p>

<h2>Running the mutant set</h2>

<br>

<p>
<b>Command line</b><br>
<div style='padding-left: 30pt'>
<tt>pheno_detect.py -c config_pheno_detect.yaml -p /path/to/project_directory</tt>
</div>
<b>Windows executable</b><br>
<div style='padding-left: 30pt'>
click on windows/pheno_detect<br>
You will firstly be prompted for the config generated from lama  (*pheno_detect.yaml)<br>
Then for the project directory containing the input folder and the groups file
</div>
</p>

<br>

<p>
A typical project directory would look something like this<br>
<img src="./Running_phenotype_detection/pasted_image005.png"><br>
pheno_detect.py calls lama.py then performs some statistical analysis on the results.  See the <a href="./Statistics.html" title="statistics" class="page">statistics</a> section
</p>

<p>
<b>Notes:</b><br>
If the input images in the mutant test set have larger dimensions than any of the wild type test set (or the padding diemnsions set in the wild type config file) an error will occur.<br>
To solve this, you will have to re-run the wild type test set and set the padding in the config file to be greater than or equal to the largest dimensions in the mutant set. 
</p>

<br>
<br>
<br>
<br>



<!-- End wiki content -->

				</tr></td></table>

			</td>
			<td width="5%">&nbsp;</td>
		</tr>
		<tr>
			<td colspan="3" align="center" valign="middle">
<a href='./Quick_start.html' class="nav">&lt;</a>
				<a href='None' class="nav">+</a>

<a href='./Statistics.html' class="nav">&gt;</a>			</td>
		</tr>
	</table>

	</body>

</html>
