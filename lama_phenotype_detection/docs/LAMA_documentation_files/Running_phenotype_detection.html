<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Running phenotype detection</title>
	<meta name="generator" content="Zim 0.65">
	<meta name="viewport" content="width=device-width">
	<!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:300&subset=latin,greek,latin-ext' rel='stylesheet' type='text/css'> -->
	<![if !IE]>
	<!-- comment out for IE since it spams the user with warnings -->
	<script type='text/javascript' src='http://code.jquery.com/jquery-1.7.1.js'></script>
	<script type='text/javascript'>
		$(window).load(function(){$("#navigation").height( $("#content").height()+65 );});
	</script>
	<![endif]>
	<style>
		body, html {
			height:100%;
			font-family:'Open Sans', sans-serif;
			line-height:1.5em;
			font-weight:300;
			background-color:#FAFAFA;
			text-rendering:geometricPrecision;
			margin:0;
			padding:0;
		}
		.wrapper {
			height:100%;
			position:relative;
		}
		#navigation {
			background-color:#F3F3F3;
			display:inline-block;
			border-right:1px solid #EAEAEA;
			padding-right:65px;
			padding-top:65px;
			padding-left:25px;
			position:relative;
			float:left;
			min-height:100%;
		}
		#content {
			float:left;
			display:inline-block;
			position:absolute;
			max-width:960px;
			padding:65px;
		}
		#navigation ul {
			margin-top:0;
			margin-bottom:0;
			padding-left:40px;
		}
		#navigation li {
			list-style-type:none;
		}
		#navigation a {
			text-decoration:none;
			color:gray;
		}
		#navigation strong {
			color:#4E9A06;
			font-weight:400;
		}
		#navigation a:hover {
			text-decoration:underline;
		}
		#content h1:nth-child(1) {
			margin-top:0;
		}
		h1,h2,h3,h4,h5,h6 {
			color:#4E9A06;
			font-weight:300;
			margin-bottom: 0;
		}
		p {
			margin-top: 0;
		}
		#content a {
			color:#CE5C00;
		}
		#content a {
			text-decoration: none;
		}
		#content a:hover {
			text-decoration: underline;
		}
		#content a:active {
			text-decoration: underline;
		}
		#content strike {
			color: grey;
		}
		#content u {
			text-decoration: none;
			background-color: yellow;
		}
		#content tt {
			color: #2e3436;
		}
		#content pre {
			color: #2e3436;
			margin-left: 20px;
		}
		.backlinks {
			color:gray;
		}
		hr.footnotes {
			width: 20%;
			margin-left: 0;
		}
		@media print{
			#navigation{
				background-color:#FFF;
			}
		}

		span.zim-tag {
			color: #ce5c00;
		}
		div.zim-object {
			border-style:solid;
			border-width:1px;
		}

		.checked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8sMEGsKGkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEBUlEQVRIx62V22tdRRTGf7Nn73P2ybntnNOe3NqkPTGgLTVUUZF6QatSLOKTPgqCIqLgQ0H/A1sQQbBYCBb1QfAxiC8tSO1FqHkwJVKtjdTGNraUmObsc9nXmfGh7cGYpM1D5nHWzPetteZb3wg2eB2YqYm4zSadsMtoboiNBH/3TE0awx6j+MRoxoTg/IYRvP19TQrJS0bzhdHGSyKFkLTtjSKwMjyiEz43ynhtP6bdjBCWyFobAf7eT7VhNF/q1FRbjYjmUohlCVPwnB+6FUxMTJipqSmUUhhjEGKd3bMT4ks/Y6oLBK2Yth8hHYtCJXOix7Nf7xLMzc0xOzvLzp078TyPNE3viW3QJPXzhNWbxFFKHCmMhoLn/FHodd48vGfhapdAacXQlkFK5dL6wIUm6fuTZPuvqDQhaMUYYyiVyuQr6rXDexYuAdi3tSv1ZJNs/R/CaszzT+1na88uXFnCEnJVgivBNN8uTJKmHQI/ptOOcXNZzMz9mOqFs90OHpipWcYwlo5P4ebnuOkrvr5wgrH+h3im7y36MzuwRXYZeKha/OhP0EkadFoxQSdGSotedR/+XwMc2XvKdNUFOFqZx6LKZWIiwjgkikNmLp/hm8sH+K1zjFTHXfBYdTi+eJArzXM0GxFxoBDCopLvo/fqEwi1XPkWkGqjFo2TgB1jOYZUKZTS/D1/ncmLh7jon0IbRWoiTi59ymzzJEEQE3cStNZsGxqlfPE57MBbOR8fP3hDGalOO9fq2DlBvmZw8xa2IxACGn6TydlD/O6f5OzSV/zif0cYhLQaEXGkKBbz7Ov/AOlXV1cxgBJRI3fuSTrpTawt18kWIZN1CFuaONI0w0WOXfsI43YIggh/KUSlhqxrMz74AkOZcWBm9QkH+Gw8NDLuITi+m0yzhluSyJzBLcpblUhFxywSRAEtPwQjsKVN30CNh0uvYuOubSHLtN3J0TO1j0pmBNuFbFWRK0gyPRZpktL2I5JQkclKakNlnh54g6ocvevUr/Ai2a7wineEkcJupA3S1Wg0nVZM2E6wbEF5U5G9Q++wI7sfR7h3N8HVNstykBfzH+KJEZwiWD0aIwxCgJ0R1Mu7GXOeJSuK93bZtQIle4D9pUNU5DC5jEsu55AvZakM5NicGyEj8uuz8bUCQgj67QfY671P3vEoeC69gy695U1U7NG7XV0pUwBjDJa1/JJlWWxzHuflzQe5FJ/GsgUVuZ2t8lEkTvfc0aNHb72flBhjVicQQqCUuvM3/M+WDVguWBrMVdDXEGZlBVEUrVCU9d9s5+fnaTQa2PZyPxEIhJaI1EEoZwX4ncynp6fXrmB4eJjR0VFarRbNZnP9P9rt9gohqNVq1Ov1ZbF/AZGev3hLJ2/zAAAAAElFTkSuQmCC)}
		.xchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8bDYnDxEwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEK0lEQVRIx9WVS2hTWRjHf/eR3CY1nbxMH2YiZRQS6qO13YlMVxY3SnVcuNIBFezGpSADLoQqLu1sHJCqdCFSXFpw4YOCSH3BtFqttTNamabX3DS5bfO6uffMoglja3RGcDMHzuac7/z/53++//cd+L8P6VuCPQYZ8ADNgBd4J31DcDcQs+GnHByRocEDv0kfBSjAOlYCs11Q+gpwDegS8LMJ+3QIK0ATzEhV8Odnz5bzw8P4dJ25aJQ/WlvJ1df/K7hSLtOcTNI+Pk69rpMTgqIQhCDvh1/VSpw79+gRrRMTmLZNezLJJsPg+a5dmOEwQlFqg1sWG16/Jv7sGWXDwBACFQjC9HcwIMONKkGp4PGAJGEDS0IQmZlhnWnye3c3eiyGo6qr3WHbrJ+dJf7gAXI6zSIr72T7/fgzmT4FHnTBsgrQBfYvTU0km5vxz86iADnAm0rRPTWFt7cXZccOJJcLAGHb2K9ekT93jmwmwwdAAFpjI6Ntbfxw5879ag7l6o1sr5eHHR3IsRgeQK/M4sQE+YEB7JcvEY6zAj45SWFgAPPxYwzHoQxIkQjTPT0kIxE+Noj8sexFn4/xnh58iQTeSpHkHAdrbIzi0BCOrmNPTpK/eJHM3bt8sCyKQCiR4NWePWSiUZw1+ZLXJm4pFKLhzBlCsRh2RUXacVgeGaF47RrL58+zcP8+RrmMkCQinZ1EL1zAjERqmkH+tLYl1G3bCJw4QUjT0IA0MJfLMX/5MqmHD0nZNiUgtGULG/r7ccXjINWuWbnmqsuFu7sb/4EDNLlcBIEioNs2KUAFGmMxmk6dQm1tRZI+3xBqEkiShBQOox05Ql1nJ26gvuIUAWiKQnj/ftStW5Fk+YuF+NldsbBA4cYN9KdPmaso8Fc62ZJtk7l1C2t0FGdxESHE1xE4hkHh6lX0oSHSpRIewC/LrPf7CSgKNpCamkI/fZr8pUuIZBIcpyaBunahPp1mub+fDyMjGKUSChCsq6Nh717q9u2jbnSU0uAgRrFIwTThyhUCqRS+hgZKLS1fJvDm87SNjZGcnsYUAjcQ8vsJ9/Xh7u1FDgRQN20iks3iDA+zZFmYhQLqzZtsj8WY3L0baY2Sf55ICCKpFHUzM2SEQAJCHg+hY8fQDh5EDgRWDoRC1J88SePRo2geD0XAcBy8b98Sv3ePYDZbbf2rFQjLIphMsmDbaEBQVQkePox26BCSz7e6i4bDrDt+nGYhmBscpFAskheC4Js3bPR4qHphFYEnlcI7P4/jdqNpGu8TCe4oCsXr1z//F2ga3+/cSfTJE0qmSVYIsKzaOZDcbjKyzFIiwfvt21kMBLA07YsetzWNd+3tLLW0sH5igvT8PH9Go/z44kX+E4LGjg7GDYOcy4XlOEgLC//5P/5LCFzxOPLmzWyIx+m6fduu7v0NVGqyTSycKksAAAAASUVORK5CYII=)}
		.unchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8qAt8h3m8AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAA60lEQVRIx+2VsQqDMBRF70sCLg5OLoKgjk7+lJ/hh+STXBwcnRz8ArMEkrxOFktbaC3tULzTg5e8k5vADXDq70VbobXmvu/hvQczg4heHrJfXxQFuq67blZbMc8zpmlCXddIkgTOuZcBUko45zCOI6y1Nz2xFSEEZFmGOI7fGg4A3nsQEZqmuXOu9jallACAtm3fvmutNaIoAjM/dkBECCF89KCbk4eAb+kEnIAT8EsAM0OIz3hSyrssUvss8t5fg+uIrLXPs0gIgWVZYIyBUurQyYdheO4gz3NUVQVjDNZ1PfSjpWmKsixvehfB9GBZ3NndrgAAAABJRU5ErkJggg==)}
		ul {list-style-image: none}
		/* ul rule needed to reset style for sub-bullets */

	</style>
</head>

<body>
	<div class="wrapper">
		<div id="navigation"> <ul>
<li><a href="file:///home/neil/git/lama/docs/LAMA_documentation.html" title="LAMA documentation" class="page">LAMA documentation</a>
<ul>
<li><a href="./Automated_staging.html" title="Automated staging" class="page">Automated staging</a></li>
<li><a href="./Config_files.html" title="Config files" class="page">Config files</a></li>
<li><a href="./Creating_a_population_average.html" title="Creating a population average" class="page">Creating a population average</a></li>
<li><a href="./Extracting_full_resolution_rois.html" title="Extracting full resolution rois" class="page">Extracting full resolution rois</a></li>
<li><a href="./Getting_started.html" title="Getting started" class="page">Getting started</a></li>
<li><a href="./Known_issues_-_furure_plans.html" title="Known issues - furure plans" class="page">Known issues - furure plans</a></li>
<li><a href="./Quick_start.html" title="Quick start" class="page">Quick start</a></li>
<li><b>Running phenotype detection</b></li>
<li><a href="./Scheduling_jobs.html" title="Scheduling jobs" class="page">Scheduling jobs</a></li>
<li><a href="./Statistics.html" title="Statistics" class="page">Statistics</a></li>
<li><a href="./Trouble_shooting.html" title="Trouble shooting" class="page">Trouble shooting</a></li>
<li><a href="./visualising_results.html" title="visualising results" class="page">visualising results</a></li>
<li><a href="./Workflow.html" title="Workflow" class="page">Workflow</a></li>
</ul></li>
</ul>
 </div>
		<div id="content">
			<h1>Running phenotype detection <a name='LAMA documentation:Running phenotype detection'></a></h1>

			<p>
Created Friday 22 January 2016
</p>

<h2>Overview</h2>

<br>

<p>
Phenotype detection occurs in two stage:
</p>

<p>
<ol type="1" start="1">
<li>Run the wild type test set. This stage creates registrered images, deformation fields, inversion files, inverted label maps etc.</li>
<li>Run the mutant test set.  As (1) with an additional statistical analysis stage using the files generated in (1) and (2). </li>
</ol>
</p>

<p>
During each of these stages, the taget image will be the population average created as described <a href="./Creating_a_population_average.html" title="here" class="page">here</a>
</p>

<br>

<h2>Running the wildtype test set</h2>

<br>

<h4>command line</h4>

<p>
<div style='padding-left: 30pt'>
<tt>lama.py -c path/to/config.yaml</tt>
</div>
</p>

<br>

<h4>windows executable</h4>

<p>
<div style='padding-left: 30pt'>
click on <tt>windows/lama</tt><br>
You will then be prompted for the path to the config file. This can be achieved by dragging the file into the command window
</div>
</p>

<br>

<h2>Requirements</h2>

<p>
<ul>
<li>A target volume, probably a population average, the creation of which is described <a href="./Creating_a_population_average.html" title="here." class="page">here.</a></li>
<li>Wild type test volumes (Should be different from the inputs to the population average)</li>
<li>config file </li>
</ul>
</p>

<p>
A typical folder structure for running the wild type test set would look like this
</p>

<p>
<img src="./Running_phenotype_detection/pasted_image007.png">
</p>

<h2>Config file</h2>

<br>

<p>
<b>Target</b><br>
Set the target to remain the same at each stage with the following line in the config file.
</p>

<p>
<div style='padding-left: 30pt'>
<tt>generate_new_target_each_stage: false</tt>
</div>
</p>

<br>

<h4>littermate_names</h4>

<p>
In our experience we have a folder with a series of wild type embryos that are used as baseline controls. When mutants are scanned we often get around two littermate controls scanned alongside. <br>
We have found that it is important to run littermate controls along with other baselines as it can help to identify littermate effects that can lead to false positive reuslts.
</p>

<br>

<p>
a csv file containing ids of volumes that were run with the mutants but are littermate controls<br>
<div style='padding-left: 30pt'>
littermate1.nrrd<br>
littermate2.nrrd
</div>
</p>

<p>
<b>Organ names</b><br>
If a labelmap is supplied, a organ/label name text file can also be given, with one organ name on each line. <br>
The first name specified with be for label 1 and the second for two etc. 
</p>

<p>
config: 
</p>

<p>
organ_names: organ_names.txt<br>
default = False
</p>

<p>
<img src="./Running_phenotype_detection/pasted_image004.png">
</p>

<br>

<p>
<b>Normalization</b><br>
After registration, a normalization step can be perfomed which applies a simple linear transformation to the image intesites. We tend to use a smooth region in the brain.<br>
The normalization is only applied when running the stats.
</p>

<p>
The roi is specified in the config file as a list of two list. [[x start, y start, z start], [ x end, y end, z end]<br>
normalization_roi: [[<a href="./35,_200,_130],_[45,_210,_140.html" title="35, 200, 130], [45, 210, 140" class="page">35, 200, 130], [45, 210, 140</a> ]]    
</p>

<p>
Below is an example showing the placement of the roi in a region of background on the target image.<br>
Ignore this. Put it in the brain
</p>

<p>
<img src="./Running_phenotype_detection/pasted_image001.png">
</p>

<p>
<b>Output of the wt test set run</b>
</p>

<p>
This is the structure of the output folder of a typical run
</p>

<p>
<img src="./Running_phenotype_detection/pasted_image003.png">
</p>

<p>
<ul>
<li><b>averages</b></li>
</ul>
<div style='padding-left: 30pt'>
The mean intensity image of the registered images at each stage
</div>
<ul>
<li><b>deformations</b></li>
</ul>
<div style='padding-left: 30pt'>
The deformation vectors generated from the x stage to the final stage
</div>
<ul>
<li><b>inverted_labels</b></li>
</ul>
<div style='padding-left: 30pt'>
The label map inverted back to the rigidly-aligned images
</div>
<ul>
<li><b>inverted transforms</b></li>
</ul>
<div style='padding-left: 30pt'>
<tt>elastix</tt> parameter files inverted for use in inverting other files at a later date
</div>
<ul>
<li><b>normalised_intensity_images</b></li>
</ul>
<div style='padding-left: 30pt'>
The background-normalised registered images
</div>
<ul>
<li><b>padded_inputs</b></li>
</ul>
<div style='padding-left: 30pt'>
The input images padded to either the specified value or the largest input dimensions
</div>
<ul>
<li><b>padded target</b></li>
</ul>
<div style='padding-left: 30pt'>
Padded target, labelmap, and mask if given
</div>
<ul>
<li><b>qc_images</b></li>
</ul>
<div style='padding-left: 30pt'>
For each registration stage, a mid-sgittal slice is saved as an image. Can be useful to quickly check if registration has proceded without problems
</div>
<ul>
<li><b>registrations</b></li>
</ul>
<div style='padding-left: 30pt'>
registrations with output images, logs, and parameter files for each stage
</div>
<ul>
<li><b>organ_volumes.csv</b></li>
</ul>
<div style='padding-left: 30pt'>
if a label map and orgasn names was given, a csv file with the calculated giving the original organ volumes in voxels 
</div>
</p>

<p>
After running lama.py, a new config file is created in the same folder as the orginal config file, prepended with pheno_detect.yaml. <br>
This file contains some paths and values that were updated during the orignal registration, such as the padded volumes paths and the new padding dimensions.
</p>

<p>
All the paths in this file are relative so the wildtype project directory can be moved, but all folders and files within the project directory must remain in the same place for downstream analysis to work correctly.
</p>

<h2>Running the mutant set</h2>

<br>

<p>
<b>Command line</b><br>
<div style='padding-left: 30pt'>
<tt>pheno_detect.py -c config_pheno_detect.yaml -p /path/to/project_directory</tt>
</div>
</p>

<p>
project_directory should contain the input images in a folder called <tt>inputs</tt>
</p>

<h4>running littermate controls</h4>

<p>
specified with -l
</p>

<p>
In our experience we have a folder with a series of wild type embryos that are used as baseline controls. When mutants are scanned we often get around two littermate controls scanned alongside. <br>
We have found that it is important to run littermate controls along with other baselines as it can help to identify littermate effects that can lead to false positive reuslts.
</p>

<p>
a csv file containing ids of volumes that were run with the mutants but are littermate controls<br>
<div style='padding-left: 30pt'>
littermate1<br>
littermate2
</div>
</p>

<p>
with this option, include your littermate controls in the same inputs folder as your mutants. They will be registered togther, but when the stats section of the pipeline is run, the littermate baselines will be included with the other baselines
</p>

<br>

<p>
<b>Windows executable</b><br>
<div style='padding-left: 30pt'>
click on windows/pheno_detect<br>
You will firstly be prompted for the config generated from lama  (*pheno_detect.yaml)<br>
Then for the project directory containing the input folder and the groups file
</div>
</p>

<br>

<p>
A typical project directory would look something like this<br>
<img src="./Running_phenotype_detection/pasted_image005.png"><br>
pheno_detect.py calls lama.py then performs some statistical analysis on the results.  See the <a href="./Statistics.html" title="statistics" class="page">statistics</a> section
</p>

<p>
<b>Notes:</b><br>
If the input images in the mutant test set have larger dimensions than any of the wild type test set (or the padding diemnsions set in the wild type config file) an error will occur.<br>
To solve this, you will have to re-run the wild type test set and set the padding in the config file to be greater than or equal to the largest dimensions in the mutant set. 
</p>

<p>
<b>Wild type subset list</b><br>
Optionally, a list of wildtypes to use in the analysis can be provided with the <tt>-wt_subset</tt> option. Giving a path to a file that contains a list of mutant volume ids(without the extension) to include in the analysis.<br>
This is useful for our work as we sometimes pick a set of wildtypes to run in the analysis based on crown-rump length of the embryos. Using this arguemnt we can choose wt's from a previous lama.py run without having to copy all the directories
</p>

<p>
example file:<br>
<div style='padding-left: 30pt'>
 <tt>dir:../../path_to_inputs</tt>
</div>
<tt>20150409_JAG2_E14.5_13.3h_WT_XX_rec_scaled_4.6823_pixel_14.0001</tt><br>
<tt>20140128_SMOC1_18.2_c_wt_rec_scaled_3.1241_pixel_14</tt><br>
<tt>20141031_EPAS1_E14.5_16.1b_WT_XY_REC_scaled_4.6878_pixel_14</tt><br>
<tt>20140107_MLLT3_16.3_e_wt_rec_scaled_5.1546_pixel_14</tt><br>
<tt>20140815_NXN_E14.5_16.4b_WT_XX_REC_scaled_2.8226_pixel_14.0001</tt><br>
<tt>20140212_OTUB1_16.1e_wt_rec_scaled_3.1241_pixel_14</tt><br>
<tt>20140515_KLHDC2_E14.5_21.1h_WT_XX_REC_scaled_2.8248_pixel_14</tt><br>
<tt>20140121_RIC8B_15.5_h_wt_rec_scaled_3.1241_pixel_14</tt><br>
<tt>20141021_CTNNBIP1_E14.5_13.4e_WT_XX_REC_scaled_4.6878_pixel_14</tt><br>
<tt>20141119_CASZ1_E14.5_22.2a_WT_XY_REC_scaled_4.6878_pixel_14</tt>
</p>

<br>
<br>
<br>



			<br>
			<span class="backlinks">
				<hr class='footnotes'>
				<b>Backlinks:</b>
				<a href='./Quick_start.html'>LAMA documentation:Quick start</a>
				
				<a href='file:///home/neil/git/lama/docs/LAMA_documentation.html'>LAMA documentation</a>
				
				<a href='./Statistics.html'>LAMA documentation:Statistics</a>
				<br /><br />
			</span>

			
		</div>
	</div>
</body>
</html>

