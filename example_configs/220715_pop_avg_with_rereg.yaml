---
############################ Config file v1 for the MRC Harwell Registration pipeline##################################
## This file is in YAML format - http://www.yaml.org/                                                                ##
## Use spaces for indentations. Do not use tabs. It helps to edit in an IDE such as PyCharm                          ##
##'true' and 'false' must be quoted within elastix param sections or python interperets them as 'True' and 'False'   ##
#######################################################################################################################

output_dir: out
fixed_volume: target/20140121RIC8B_15.4_b_wt_rec_scaled_3.1241_pixel_14.tif
inputvolumes_dir: inputs
#fixed_mask: target/fixed_mask_for_reg.nrrd
pad_dims: true
threads: 6
filetype: nrrd
compress_averages: true
output_metadata_file: output_metadata.yaml 
voxel_size: 28

# true for creating an average. false for phenotype detection
generate_new_target_each_stage: true
re-register_each_stage: true



################################### Global registration parameters, applied to all stages ##############################
global_elastix_params:
    FixedInternalImagePixelType: short
    MovingInternalImagePixelType: short
    FixedImageDimension: 3
    MovingImageDimension: 3
    UseDirectionCosines: 'true'
    FixedImagePyramid: FixedSmoothingImagePyramid
    MovingImagePyramid: MovingSmoothingImagePyramid
    ResultImagePixelType: float
    ResultImageFormat: nrrd
    CompressResultImage: 'true'
    Interpolator: BSplineInterpolator
    ResampleInterpolator: FinalBSplineInterpolator
    Resampler: DefaultResampler
    NumberOfHistogramBins: 32
    HowToCombineTransforms: Compose
    NewSamplesEveryIteration: 'true'
    ImageSampler: Random
    FinalBSplineInterpolationOrder: 3
    DefaultPixelValue: 0
    WriteTransformParametersEachIteration: 'false'
    WriteResultImage: 'true'
    AutomaticScalesEstimation: 'true'
    AutomaticTransformInitialization: 'true'
    SP_a: 1000.0
    SP_alpha: 0.602
    SP_A: 32000

################################ Stage-specific registration parameters ################################################
registration_stage_params:

#### Rigid #############################################################################################################
    
    - stage_id: rigid
      elastix_parameters:
        Metric: AdvancedNormalizedCorrelation
        Registration: MultiResolutionRegistration
        MaximumNumberOfIterations: 300
        NumberOfResolutions: 4
        NumberOfSpatialSamples: 2000
        FixedKernelBSplineOrder: 1
        MovingKernelBSplineOrder: 3
        Transform: EulerTransform
        Optimizer: StandardGradientDescent
        Metric: AdvancedNormalizedCorrelation
        FixedLimitRangeRatio: 0.0
        MovingLimitRangeRatio: 0.0
        FixedKernelBSplineOrder: 1
        MovingKernelBSplineOrder: 3
        UseDifferentiableOverlap: 'false'
        



 #### Affine #############################################################################################################

    - stage_id: affine
      elastix_parameters:
        Registration: MultiResolutionRegistration
        NumberOfResolutions: 4
        Optimizer: AdaptiveStochasticGradientDescent
        Transform: AffineTransform
        Metric: AdvancedNormalizedCorrelation
        MaximumNumberOfIterations: 200
        NumberOfSpatialSamples: 2000


#### Deformable registrations. #################################
    
    - stage_id: deformable_to_64
      elastix_parameters:
        Registration: MultiResolutionRegistration
        NumberOfResolutions: 1
        NumberOfSpatialSamples: 2000
        NumberOfGradientMeasurements: 10
        NumberOfSamplesForExactGradient: 20000
        NumberOfJacobianMeasurements: 4000
        MaximumNumberOfIterations: 200
        AutomaticParameterEstimation: 'true'
        UseAdaptiveStepSizes: 'true'
        ASGDParameterEstimationMethod: DisplacementDistribution
        Optimizer: AdaptiveStochasticGradientDescent
        Transform: BSplineTransform
        Metric: AdvancedMattesMutualInformation
        FinalGridSpacingInVoxels: 64
        MaximumStepLength: 3.0
    
    - stage_id: deformable_to_32
      inherit_elx_params: deformable_to_64
      elastix_parameters:
        FinalGridSpacingInVoxels: 32
        MaximumStepLength: 2.0


    - stage_id: deformable_to_16
      inherit_elx_params: deformable_to_64
      elastix_parameters:
        FinalGridSpacingInVoxels: 16
        MaximumStepLength: 1.0

    - stage_id: deformable_to_12
      inherit_elx_params: deformable_to_64
      elastix_parameters:
        FinalGridSpacingInVoxels: 12
        MaximumStepLength: 1.0

    - stage_id: deformable_to_10
      inherit_elx_params: deformable_to_64
      elastix_parameters:
        FinalGridSpacingInVoxels: 10
        MaximumStepLength: 1.0

    - stage_id: deformable_to_8
      inherit_elx_params: deformable_to_64
      elastix_parameters:
        FinalGridSpacingInVoxels: 8
        MaximumStepLength: 1.0




            
        
            
